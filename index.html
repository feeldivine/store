<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Feel Divine</title>
  <style>
    .checkout-step { display: none; }
    .checkout-step.active { display: block; }
  </style>
</head>
<body>

  <!-- Step 1: Shipping Info -->
  <div id="checkout-step-1" class="checkout-step active">
    <h2>Shipping Information</h2>
    <form id="shipping-form">
      <input type="text" id="shipping-name" placeholder="Full Name" required><br>
      <input type="email" id="shipping-email" placeholder="Email" required><br>
      <input type="text" id="shipping-address" placeholder="Address" required><br>
      <button type="submit">Continue to Payment</button>
    </form>
  </div>

  <!-- Step 2: Payment -->
  <div id="checkout-step-2" class="checkout-step">
    <h2>Payment</h2>
    <p>Total: <span id="payment-amount">₦0.00</span></p>
    <button id="paystack-button">Pay with Paystack</button>
  </div>

  <!-- Step 3: Confirmation -->
  <div id="checkout-step-3" class="checkout-step">
    <h2>Order Confirmation</h2>
    <p>Thank you! Your payment was successful.</p>
  </div>

  <!-- Paystack SDK -->
  <script src="https://js.paystack.co/v1/inline.js"></script>

  <script>
    // Example cart (replace with your own dynamic cart)
    let cart = [
      { name: "Luxury Hoodie", price: 15000, quantity: 1 },
      { name: "Streetwear Cap", price: 5000, quantity: 2 }
    ];

    // Step 1 → Step 2
    document.getElementById("shipping-form").addEventListener("submit", function(e) {
      e.preventDefault();
      document.getElementById("checkout-step-1").classList.remove("active");
      document.getElementById("checkout-step-2").classList.add("active");

      // Calculate total in naira
      const totalAmountNaira = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById("payment-amount").innerText = "₦" + totalAmountNaira.toLocaleString();
    });

    // Paystack Payment
    document.getElementById("paystack-button").addEventListener("click", function() {
      const email = document.getElementById("shipping-email").value;
      const totalAmountNaira = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

      let handler = PaystackPop.setup({
        key: 'pk_live_44c9f1fdf5cf23eee9f9715dcaa237c174f6e139', // your live public key
        email: email,
        amount: totalAmountNaira * 100, // convert naira → kobo
        currency: 'NGN',
        ref: '' + Math.floor((Math.random() * 1000000000) + 1), // unique reference
        callback: function(response) {
          console.log("Payment successful. Reference: " + response.reference);

          // ✅ Move to confirmation step
          document.getElementById("checkout-step-2").classList.remove("active");
          document.getElementById("checkout-step-3").classList.add("active");

          // ✅ Clear cart after success
          cart = [];
          localStorage.removeItem("feelDivineCart");
        },
        onClose: function() {
          alert('Payment window closed.');
        }
      });

      handler.openIframe();
    });
  </script>
</body>
</html>
